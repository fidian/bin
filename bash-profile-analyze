#!/usr/bin/env bash
# Looks at a sample-*.log and sample-*.tim as generated by the profiling
# script and dumps the two column format for commands.
# https://stackoverflow.com/questions/5014823/how-to-profile-a-bash-shell-script-slow-startup

if [[ -z "$1" || ! -f "$1" ]]; then
    echo "Specify a path to the log or the timing file."
    exit 1
fi

logfile=${1%.*}.log
timfile=${1%.*}.tim
last=
paste <(
    while read tim; do
        [[ -z "$last" ]] && last=${tim//.} && first=${tim//.}
        crt=000000000$((${tim//.}-10#0$last))
        ctot=000000000$((${tim//.}-10#0$first))
        printf "%12.9f %12.9f\n" ${crt:0:${#crt}-9}.${crt:${#crt}-9} ${ctot:0:${#ctot}-9}.${ctot:${#ctot}-9}
        last=${tim//.}
    done < "$timfile"
) "$logfile"
